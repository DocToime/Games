
let gameData = {
    "Beginner": {
        "1": [
            {"words": ["dog"], "correct": "dog", "hint": "The ___ chases the cat."},
            {"words": ["tug"], "correct": "tug", "hint": "We ___ on the rope."},
            {"words": ["fog"], "correct": "fog", "hint": "The ___ makes it hard to see."},
            {"words": ["bag"], "correct": "bag", "hint": "I carry my books in a ___."},
            {"words": ["fun"], "correct": "fun", "hint": "Playing games is a lot of ___."},
            {"words": ["mat"], "correct": "mat", "hint": "Please wipe your feet on the ___."},
            {"words": ["man"], "correct": "man", "hint": "The ___ is walking his dog."},
            {"words": ["nun"], "correct": "nun", "hint": "The ___ lives at the church."},
            {"words": ["hot"], "correct": "hot", "hint": "The soup is too ___ to eat."},
            {"words": ["bog"], "correct": "bog", "hint": "The ___ is a wet, muddy area."}
        ]},

    "Reception": {
        "1": [
            {"words": ["go"], "correct": "go", "hint": "It's your turn to ___."},
            {"words": ["up"], "correct": "up", "hint": "Please look ___ at the sky."},
            {"words": ["we"], "correct": "we", "hint": "___ are going to the park."},
            {"words": ["me"], "correct": "me", "hint": "Can you help ___ with this?"},
            {"words": ["my"], "correct": "my", "hint": "This is ___ favorite toy."},
            {"words": ["on"], "correct": "on", "hint": "The cat is sitting ___ the table."},
            {"words": ["no"], "correct": "no", "hint": "___, I don't want any."},
            {"words": ["he"], "correct": "he", "hint": "___ is playing soccer."},
            {"words": ["is"], "correct": "is", "hint": "There ___ a bird in the tree."},
            {"words": ["it"], "correct": "it", "hint": "___ is raining outside."}],
        "2": [
            {"words": ["of"], "correct": "of", "hint": "A slice ___ pizza."},
            {"words": ["at"], "correct": "at", "hint": "Look ___ the stars."},
            {"words": ["to"], "correct": "to", "hint": "We went ___ the store."},
            {"words": ["in"], "correct": "in", "hint": "The cookies are ___ the jar."},
            {"words": ["am"], "correct": "am", "hint": "I ___ happy today."},
            {"words": ["you"], "correct": "you", "hint": "Are ___ coming over?"},
            {"words": ["day"], "correct": "day", "hint": "Have a nice ___!"},
            {"words": ["was"], "correct": "was", "hint": "He ___ at the park yesterday."},
            {"words": ["are"], "correct": "are", "hint": "You ___ my best friend."},
            {"words": ["the"], "correct": "the", "hint": "___ sun is shining."}],
        "3": [
            {"words": ["dog"], "correct": "dog", "hint": "The ___ barks loudly."},
            {"words": ["big"], "correct": "big", "hint": "That is a very ___ tree."},
            {"words": ["she"], "correct": "she", "hint": "___ is reading a book."},
            {"words": ["and"], "correct": "and", "hint": "Fish ___ chips are popular in Britain."},
            {"words": ["see"], "correct": "see", "hint": "Can you ___ the bird?"},
            {"words": ["mum"], "correct": "mum", "hint": "My ___ is baking a cake."},
            {"words": ["yes"], "correct": "yes", "hint": "___, I would like some tea."},
            {"words": ["for"], "correct": "for", "hint": "This present is ___ you."},
            {"words": ["dad"], "correct": "dad", "hint": "My ___ is fixing the car."},
            {"words": ["can"], "correct": "can", "hint": "I ___ run very fast."}],
        "4": [
            {"words": ["cat"], "correct": "cat", "hint": "The ___ is sleeping on the sofa."},
            {"words": ["get"], "correct": "get", "hint": "Please ___ your coat."},
            {"words": ["all"], "correct": "all", "hint": "___ the children are playing."},
            {"words": ["come"], "correct": "come", "hint": "___ here, please."},
            {"words": ["went"], "correct": "went", "hint": "We ___ to the zoo yesterday."},
            {"words": ["look"], "correct": "look", "hint": "Have a ___ at this picture."},
            {"words": ["this"], "correct": "this", "hint": "___ is my favourite toy."},
            {"words": ["like"], "correct": "like", "hint": "I ___ ice cream."},
            {"words": ["they"], "correct": "they", "hint": "___ are going to the cinema."},
            {"words": ["away"], "correct": "away", "hint": "The bird flew ___."}],
        "5": [
            {"words": ["play"], "correct": "play", "hint": "Let's ___ hide and seek."},
            {"words": ["said"], "correct": "said", "hint": "He ___ he was tired."},
            {"words": ["going"], "correct": "going", "hint": "Are you ___ to the party?"},
            {"words": ["I"], "correct": "I", "hint": "___ am learning to read."},
            {"words": ["be"], "correct": "be", "hint": "You will ___ a great player."},
            {"words": ["So"], "correct": "So", "hint": "___, what shall we do now?"},
            {"words": ["do"], "correct": "do", "hint": "What shall we ___ today?"},
            {"words": ["oh"], "correct": "oh", "hint": "___, I forgot my bag!"},
            {"words": ["Mr"], "correct": "Mr", "hint": "___ Smith is our neighbour."},
            {"words": ["her"], "correct": "her", "hint": "The cat followed ___ home."}],
        "6": [
            {"words": ["one"], "correct": "one", "hint": "He was the ___ who won."},
            {"words": ["out"], "correct": "out", "hint": "Please go ___ and play."},
            {"words": ["Mrs"], "correct": "Mrs", "hint": "___ Jones bakes delicious cakes."},
            {"words": ["into"], "correct": "into", "hint": "She went ___ the house."},
            {"words": ["have"], "correct": "have", "hint": "Do you ___ a pencil?"},
            {"words": ["some"], "correct": "some", "hint": "Would you like ___ cake?"},
            {"words": ["when"], "correct": "when", "hint": "I wonder ___ it will rain."},
            {"words": ["were"], "correct": "were", "hint": "They ___ at the park yesterday."},
            {"words": ["there"], "correct": "there", "hint": "Look, ___ is your bus!"},
            {"words": ["their"], "correct": "their", "hint": "The kids rode ___ bikes."}],
        "7": [
            {"words": ["asked"], "correct": "asked", "hint": "She ___ for a glass of water."},
            {"words": ["could"], "correct": "could", "hint": "I thought I ___ hear a bird."},
            {"words": ["little"], "correct": "little", "hint": "The ___ kitten was lost."},
            {"words": ["called"], "correct": "called", "hint": "The dog is ___ Buddy."},
            {"words": ["people"], "correct": "people", "hint": "Many ___ like to swim."},
            {"words": ["looked"], "correct": "looked", "hint": "He ___ out the window."},
            {"words": ["abacus"], "correct": "abacus", "hint": "___ is the name of a school."}],
        "Days": [
            {"words": ["Monday"], "correct": "Monday", "hint": "___ is named after the Moon."},
            {"words": ["Tuesday"], "correct": "Tuesday", "hint": "___ is named for Tyr, the Norse god of war."},
            {"words": ["Wednesday"], "correct": "Wednesday", "hint": "___ is named after Odin, the Norse god of wisdom and war."},
            {"words": ["Thursday"], "correct": "Thursday", "hint": "___ is named for Thor, the Norse god of thunder."},
            {"words": ["Friday"], "correct": "Friday", "hint": "___ is named after Frigg, the Norse goddess of love and fertility."},
            {"words": ["Saturday"], "correct": "Saturday", "hint": "___ is named for Saturn, the Roman god of agriculture and wealth."},
            {"words": ["Sunday"], "correct": "Sunday", "hint": "___ is named after the Sun."}],
        "Months": [
            {"words": ["January"], "correct": "January", "hint": "___ is named after Janus, the Roman god of doors and gates."},
            {"words": ["February"], "correct": "February", "hint": "___ is named after Februa, an early Roman festival and cleansing ritual."},
            {"words": ["March"], "correct": "March", "hint": "___ is named for Mars, the Roman god of war."},
            {"words": ["April"], "correct": "April", "hint": "___ may be derived from the Latin word 'aperire', meaning 'to open', possibly referring to the opening or blossoming of flowers and trees."},
            {"words": ["May"], "correct": "May", "hint": "___ is named after Maia, an earth goddess of growing plants."},
            {"words": ["June"], "correct": "June", "hint": "___ is named after Juno, the Roman goddess of marriage and the well-being of women."},
            {"words": ["July"], "correct": "July", "hint": "___ was named in honour of Julius Caesar."},
            {"words": ["August"], "correct": "August", "hint": "___ was named in honour of Augustus Caesar."},
            {"words": ["September"], "correct": "September", "hint": "___, meaning 'seventh', was originally the seventh month in the ancient Roman calendar."},
            {"words": ["October"], "correct": "October", "hint": "___, meaning 'eighth', was originally the eighth month in the ancient Roman calendar."},
            {"words": ["November"], "correct": "November", "hint": "___, meaning 'ninth', was originally the ninth month in the ancient Roman calendar."},
            {"words": ["December"], "correct": "December", "hint": "___, meaning 'tenth', was originally the tenth month in the ancient Roman calendar."}],
        "Numbers 0-10": [
            {"words": ["zero"], "correct": "zero", "hint": "___ is the number that represents no quantity or size."},
            {"words": ["one"], "correct": "one", "hint": "___ is the first natural number."},
            {"words": ["two"], "correct": "two", "hint": "___ is the only even prime number."},
            {"words": ["three"], "correct": "three", "hint": "___ is often used to represent balance, as in a tripod."},
            {"words": ["four"], "correct": "four", "hint": "___ is the number of sides in a square."},
            {"words": ["five"], "correct": "five", "hint": "A starfish typically has ___ arms."},
            {"words": ["six"], "correct": "six", "hint": "A standard die has ___ faces."},
            {"words": ["seven"], "correct": "seven", "hint": "There are ___ days in a week."},
            {"words": ["eight"], "correct": "eight", "hint": "An octopus has ___ tentacles."},
            {"words": ["nine"], "correct": "nine", "hint": "A cat is said to have ___ lives."},
            {"words": ["ten"], "correct": "ten", "hint": "There are ___ fingers on two hands."}],
        "Numbers 11-20": [
            {"words": ["eleven"], "correct": "eleven", "hint": "___ is the first number after ten."},
            {"words": ["twelve"], "correct": "twelve", "hint": "A dozen is made up of ___ items."},
            {"words": ["thirteen"], "correct": "thirteen", "hint": "___ is considered an unlucky number in some cultures."},
            {"words": ["fourteen"], "correct": "fourteen", "hint": "Valentine's Day falls on February ___."},
            {"words": ["fifteen"], "correct": "fifteen", "hint": "In tennis, the first point won is ___."},
            {"words": ["sixteen"], "correct": "sixteen", "hint": "A sweet ___ party is a coming-of-age celebration."},
            {"words": ["seventeen"], "correct": "seventeen", "hint": "___ is the age at which you can learn to drive in the UK."},
            {"words": ["eighteen"], "correct": "eighteen", "hint": "When you turn ___, you are considered an adult in many countries."},
            {"words": ["nineteen"], "correct": "nineteen", "hint": "___ is the last of the 'teen' numbers."},
            {"words": ["twenty"], "correct": "twenty", "hint": "A score is ___ years."}],
        "colours": [
            {"words": ["red"], "correct": "red", "hint": "Apples can be ___. It's a very bright colour."},
            {"words": ["blue"], "correct": "blue", "hint": "The sky is often ___. It's a cool colour."},
            {"words": ["yellow"], "correct": "yellow", "hint": "Lemons are ___. It's a very bright colour."},
            {"words": ["green"], "correct": "green", "hint": "Grass is ___. Leaves are often this colour too."},
            {"words": ["orange"], "correct": "orange", "hint": "Carrots are ___. It's like a mix of red and yellow."},
            {"words": ["purple"], "correct": "purple", "hint": "Grapes can be ___. It's a dark colour."},
            {"words": ["pink"], "correct": "pink", "hint": "Bubblegum is often ___. It's a light red."},
            {"words": ["brown"], "correct": "brown", "hint": "Chocolate is ___. Many trees are this colour."},
            {"words": ["black"], "correct": "black", "hint": "The night is ___. Ravens are this colour too."},
            {"words": ["white"], "correct": "white", "hint": "Snow is ___. It's the brightest colour."}]
                              
        },
    "Year1": {
        "1": [
            {"words": ["an"], "correct": "an", "hint": "I saw ___ apple on the table."},
            {"words": ["do"], "correct": "do", "hint": "What shall we ___ now?"},
            {"words": ["be"], "correct": "be", "hint": "Please ___ quiet in the library."},
            {"words": ["by"], "correct": "by", "hint": "The cat sat ___ the fire."},
            {"words": ["as"], "correct": "as", "hint": "Quiet ___ a mouse."},
            {"words": ["if"], "correct": "if", "hint": "I'll go out ___ it stops raining."},
            {"words": ["or"], "correct": "or", "hint": "Would you like tea ___ coffee?"},
            {"words": ["so"], "correct": "so", "hint": "He was hungry, ___ he ate a sandwich."},
            {"words": ["us"], "correct": "us", "hint": "Mum will take ___ to the park."},
            {"words": ["her"], "correct": "her", "hint": "I gave the book to ___."}],
        "2": [
            {"words": ["who"], "correct": "who", "hint": "___ is knocking at the door?"},
            {"words": ["may"], "correct": "may", "hint": "You ___ have a biscuit."},
            {"words": ["did"], "correct": "did", "hint": "___ you see the cat?"},
            {"words": ["him"], "correct": "him", "hint": "She passed the ball to ___."},
            {"words": ["his"], "correct": "his", "hint": "That is ___ bicycle."},
            {"words": ["put"], "correct": "put", "hint": "Please ___ your toys away."},
            {"words": ["you"], "correct": "you", "hint": "Did ___ finish your homework?"},
            {"words": ["ran"], "correct": "ran", "hint": "He ___ around the park."},
            {"words": ["how"], "correct": "how", "hint": "___ are you today?"},
            {"words": ["new"], "correct": "new", "hint": "She has a ___ dress."}],
        "3": [
            {"words": ["saw"], "correct": "saw", "hint": "I ___ a bird in the tree."},
            {"words": ["two"], "correct": "two", "hint": "There are ___ apples on the table."},
            {"words": ["not"], "correct": "not", "hint": "I am ___ going to bed yet."},
            {"words": ["bed"], "correct": "bed", "hint": "It's time to go to ___."},
            {"words": ["now"], "correct": "now", "hint": "We will leave ___."},
            {"words": ["off"], "correct": "off", "hint": "The cat jumped ___ the wall."},
            {"words": ["boy"], "correct": "boy", "hint": "The young ___ played football."},
            {"words": ["old"], "correct": "old", "hint": "My grandad is very ___."},
            {"words": ["had"], "correct": "had", "hint": "She ___ a great time at the party."},
            {"words": ["way"], "correct": "way", "hint": "Which ___ did they go?"}],
        "4": [
            {"words": ["but"], "correct": "but", "hint": "I like cats, ___ I love dogs more."},
            {"words": ["one"], "correct": "one", "hint": "He is the ___ who won the race."},
            {"words": ["has"], "correct": "has", "hint": "She ___ a new book."},
            {"words": ["our"], "correct": "our", "hint": "This is ___ house."},
            {"words": ["man"], "correct": "man", "hint": "The ___ is walking his dog."},
            {"words": ["out"], "correct": "out", "hint": "Let's go ___ for a walk."},
            {"words": ["got"], "correct": "got", "hint": "He ___ a new bike for his birthday."},
            {"words": ["too"], "correct": "too", "hint": "It's ___ hot outside."},
            {"words": ["many"], "correct": "many", "hint": "There are ___ sweets in the jar."},
            {"words": ["over"], "correct": "over", "hint": "The ball went ___ the fence."}],
        "5": [
            {"words": ["then"], "correct": "then", "hint": "First we eat, ___ we play."},
            {"words": ["here"], "correct": "here", "hint": "Come ___ and see this."},
            {"words": ["will"], "correct": "will", "hint": "I ___ be back soon."},
            {"words": ["more"], "correct": "more", "hint": "Can I have some ___ cake, please?"},
            {"words": ["push"], "correct": "push", "hint": "Please ___ the door to open it."},
            {"words": ["with"], "correct": "with", "hint": "She played ___ her toys."},
            {"words": ["much"], "correct": "much", "hint": "How ___ is that toy?"},
            {"words": ["pull"], "correct": "pull", "hint": "___ the rope to ring the bell."},
            {"words": ["home"], "correct": "home", "hint": "We're going ___ now."},
            {"words": ["must"], "correct": "must", "hint": "You ___ be quiet in the library."}],
        "6": [
            {"words": ["time"], "correct": "time", "hint": "What ___ is it?"},
            {"words": ["your"], "correct": "your", "hint": "Is this ___ pencil?"},
            {"words": ["name"], "correct": "name", "hint": "What is ___ of your school?"},
            {"words": ["back"], "correct": "back", "hint": "He looked ___ to wave goodbye."},
            {"words": ["door"], "correct": "door", "hint": "Please close the ___."},
            {"words": ["took"], "correct": "took", "hint": "She ___ her book to school."},
            {"words": ["ball"], "correct": "ball", "hint": "He kicked the ___ into the goal."},
            {"words": ["down"], "correct": "down", "hint": "The cat climbed ___ from the tree."},
            {"words": ["next"], "correct": "next", "hint": "Who is ___ in line?"},
            {"words": ["tree"], "correct": "tree", "hint": "The bird is in the ___."}],
        "7": [
            {"words": ["jump"], "correct": "jump", "hint": "Can you ___ over the puddle?"},
            {"words": ["seen"], "correct": "seen", "hint": "Have you ever ___ a lion?"},
            {"words": ["from"], "correct": "from", "hint": "This letter is ___ my friend."},
            {"words": ["just"], "correct": "just", "hint": "I've ___ finished my homework."},
            {"words": ["girl"], "correct": "girl", "hint": "The ___ is playing with her doll."},
            {"words": ["last"], "correct": "last", "hint": "She was the ___ to leave."},
            {"words": ["very"], "correct": "very", "hint": "This cake is ___ tasty."},
            {"words": ["been"], "correct": "been", "hint": "I have ___ to London."},
            {"words": ["good"], "correct": "good", "hint": "She is a ___ swimmer."},
            {"words": ["want"], "correct": "want", "hint": "Do you ___ to play a game?"}],
        "8": [
            {"words": ["some"], "correct": "some", "hint": "Would you like ___ juice?"},
            {"words": ["live"], "correct": "live", "hint": "They ___ in a big house."},
            {"words": ["once"], "correct": "once", "hint": "___ upon a time, there was a king."},
            {"words": ["take"], "correct": "take", "hint": "Can you ___ this to your mum?"},
            {"words": ["half"], "correct": "half", "hint": "I ate ___ of the pizza."},
            {"words": ["love"], "correct": "love", "hint": "I ___ going to the park."},
            {"words": ["than"], "correct": "than", "hint": "He is faster ___ his brother."},
            {"words": ["were"], "correct": "were", "hint": "They ___ happy to see me."},
            {"words": ["made"], "correct": "made", "hint": "She ___ a beautiful painting."},
            {"words": ["that"], "correct": "that", "hint": "Do you see ___ bird?"}],
        "9": [
            {"words": ["what"], "correct": "what", "hint": "___ is your favourite colour?"},
            {"words": ["call"], "correct": "call", "hint": "I will ___ my friend tonight."},
            {"words": ["have"], "correct": "have", "hint": "Do you ___ a pet?"},
            {"words": ["make"], "correct": "make", "hint": "Can you ___ a cake?"},
            {"words": ["when"], "correct": "when", "hint": "___ is your birthday?"},
            {"words": ["came"], "correct": "came", "hint": "He ___ to my house yesterday."},
            {"words": ["help"], "correct": "help", "hint": "Can you ___ me with this puzzle?"},
            {"words": ["them"], "correct": "them", "hint": "Give the books to ___."},
            {"words": ["about"], "correct": "about", "hint": "What is this story ___?"},
            {"words": ["can't"], "correct": "can't", "hint": "I ___ find my socks."}],
        "10": [
            {"words": ["after"], "correct": "after", "hint": "We will play ___ lunch."},
            {"words": ["could"], "correct": "could", "hint": "I thought I ___ hear a bird."},
            {"words": ["there"], "correct": "there", "hint": "Look, ___ is a rainbow!"},
            {"words": ["again"], "correct": "again", "hint": "Let's read the story ___."},
            {"words": ["these"], "correct": "these", "hint": "___ are my favourite biscuits."},
            {"words": ["three"], "correct": "three", "hint": "She has ___ red balloons."},
            {"words": ["would"], "correct": "would", "hint": "___ you like some cake?"},
            {"words": ["don't"], "correct": "don't", "hint": "I ___ know the answer."},
            {"words": ["house"], "correct": "house", "hint": "They live in a big ___."},
            {"words": ["first"], "correct": "first", "hint": "He was the ___ to arrive."}],
        "11": [
            {"words": ["night"], "correct": "night", "hint": "The stars come out at ___."},
            {"words": ["laugh"], "correct": "laugh", "hint": "They all had a ___ together."},
            {"words": ["water"], "correct": "water", "hint": "Please may I have a glass of ___?"},
            {"words": ["lived"], "correct": "lived", "hint": "She ___ in a small village."},
            {"words": ["their"], "correct": "their", "hint": "The children played in ___ garden."},
            {"words": ["where"], "correct": "where", "hint": "___ did you put my book?"},
            {"words": ["people"], "correct": "people", "hint": "Many ___ visit the museum."},
            {"words": ["school"], "correct": "school", "hint": "I go to ___ every day."},
            {"words": ["should"], "correct": "should", "hint": "You ___ wear a coat."},
            {"words": ["sister"], "correct": "sister", "hint": "His ___ is my friend."}],
        "12": [
            {"words": ["little"], "correct": "little", "hint": "She has a ___ kitten."},
            {"words": ["called"], "correct": "called", "hint": "The dog is ___ Max."},
            {"words": ["another"], "correct": "another", "hint": "Can I have ___ biscuit, please?"},
            {"words": ["because"], "correct": "because", "hint": "I'm happy ___ it's sunny."},
            {"words": ["brother"], "correct": "brother", "hint": "My ___ is older than me."}]
    
            // ... Additional levels can be added in the same structure ...
        }
        
    };

const introAudios = [
    "the word I'd like you to spell is",
    "the next word is",
    "this is a tricky one. please spell",
    "please could you spell",
    "now spell"
];

let currentDifficulty = "Beginner"; // Default difficulty
let currentLevel = "1"; // Default level
let currentQuestionIndex = 0;
let score = 0;
let mistakes = 0;
let hintUsed = false;
const gameContainer = document.getElementById('game-container');


function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}

function createWordButtons(words) {
    const wordOptionsContainer = document.getElementById('word-options');
    wordOptionsContainer.innerHTML = '';
    hintUsed = false;
    const playAudioButton = document.getElementById('play-audio');
    playAudioButton.style.display = 'none';

    // Creating only one button and hiding it
    const word = words[0]; // Assuming the first word is the one to guess
    const button = document.createElement('button');
    button.innerText = word;
    button.style.display = 'none'; // Hide the button initially
    button.addEventListener('click', () => handleWordSelection(word));
    wordOptionsContainer.appendChild(button);
    playWordAudio();
    displayHint();

    setTimeout(() => {
        document.getElementById('play-audio').style.display = 'block';
    }, 0); // 20000 milliseconds = 20 seconds
}


function updateDisplay(message) {
    const messageElement = document.getElementById('message');
    messageElement.innerHTML = message || '&nbsp;'; // Replace an empty message with a non-breaking space
    document.getElementById('score').innerText = 'Score: ' + score;
    document.getElementById('mistakes').innerText = 'Mistakes: ' + mistakes;
    document.getElementById('hint').innerText = '';
}

function clearMessage() {
    const messageElement = document.getElementById('message');
    if (messageElement.innerHTML === 'Correct!') {
        messageElement.innerHTML = '&nbsp;'; // Replace the "Correct!" message with a non-breaking space
    }
}

function handleWordSelection(selectedWord) {
    const currentQuestion = gameData[currentDifficulty][currentLevel][currentQuestionIndex];

    if (selectedWord === currentQuestion.correct) {
        gameContainer.classList.add('flash-green');
        setTimeout(() => gameContainer.classList.remove('flash-green'), 500);
        score++;
        updateDisplay('Correct!');
        // Schedule clearMessage to run after 5 seconds
        setTimeout(clearMessage, 5000);
        currentQuestionIndex++;
                
        if (currentQuestionIndex >= gameData[currentDifficulty][currentLevel].length) {
            updateDisplay('Round ' + currentLevel + ' complete! Moving to next level...');
            finishLevel();
        } else {
            setTimeout(() => {
                createWordButtons(gameData[currentDifficulty][currentLevel][currentQuestionIndex].words);
            }, 500);
        }
    } else {
        gameContainer.classList.add('flash-red');
        setTimeout(() => gameContainer.classList.remove('flash-red'), 500);
        mistakes++;
        updateDisplay('This is a tough one! Try again, or use the Hint button.');
        // Google Analytics Event for a Mistake
        gtag('event', 'make_mistake', {
            'event_category': 'Game Actions',
            'event_label': `Mistake Made - Difficulty: ${currentDifficulty}, Level: ${currentLevel}, Question: ${currentQuestionIndex}`
        });
    }
}



function startLevel(difficulty, level) {
    currentDifficulty = difficulty;
    currentLevel = String(level); // Ensure level is a string
    currentQuestionIndex = 0;
    score = 0;
    mistakes = 0;

    // Update the difficulty and level dropdowns to reflect the new difficulty and level
    const difficultySelect = document.getElementById('difficulty-selector');
    const levelSelect = document.getElementById('level-select');
    difficultySelect.value = currentDifficulty;
    levelSelect.value = currentLevel;

    // Additional logic to handle invalid difficulty or level
    if (!gameData[currentDifficulty] || !gameData[currentDifficulty][currentLevel]) {
        console.error('Invalid difficulty or level');
        return;
    }

    createWordButtons(gameData[currentDifficulty][currentLevel][currentQuestionIndex].words);
    setupGameContainer(); // Set up the game container for the spelling display
    createKeyboard(); // Create the keyboard for spelling input
    updateDisplay('');
    document.getElementById('start-button').style.display = 'none';
    document.getElementById('instructions-button').style.display = 'none';

    // Show the hint button etc when the game starts
    document.getElementById('hint-button').style.display = 'block';
    document.getElementById('score-container').style.display = 'block';
    document.getElementById('mistakes').style.display = 'block';

    // Automatically play audio
    displayHint();


    gtag('event', 'start_game', {
        'event_category': 'Game Actions',
        'event_label': `Game Started - Difficulty: ${difficulty}, Level: ${level}`
    });
}





document.addEventListener('DOMContentLoaded', () => {
    // Populate difficulties and levels
    populateDifficulties();
    populateLevels(currentDifficulty);

    // Set up event listeners for dropdowns and buttons
    const difficultySelect = document.getElementById('difficulty-selector');
    const levelSelect = document.getElementById('level-select');

    difficultySelect.addEventListener('change', () => {
        populateLevels(difficultySelect.value); // Populate levels based on the selected difficulty
        showStartNewGameButton();
    });

    levelSelect.addEventListener('change', showStartNewGameButton);

    function showStartNewGameButton() {
        document.getElementById('start-new-game').style.display = 'block';
    }

    document.getElementById('start-new-game').addEventListener('click', () => {
        const selectedDifficulty = difficultySelect.value;
        const selectedLevel = levelSelect.value;
        startLevel(selectedDifficulty, selectedLevel);
        document.getElementById('start-new-game').style.display = 'none'; // Hide the button after starting the game
    });
    document.getElementById('start-button').addEventListener('click', () => {
        const selectedDifficulty = difficultySelect.value;
        const selectedLevel = levelSelect.value;
        startLevel(selectedDifficulty, selectedLevel);
    });

    document.getElementById('hint-button').addEventListener('click', function() {
        const correctWord = gameData[currentDifficulty][currentLevel][currentQuestionIndex].correct;
        flashWord(correctWord);
    });

    // Font selector logic
    var fontSelector = document.getElementById('font-selector');
    if (fontSelector) {
        fontSelector.addEventListener('change', function() {
            var selectedFont = this.value;
            document.body.style.fontFamily = selectedFont;
            var wordButtons = document.querySelectorAll('#word-options button');
            wordButtons.forEach(function(button) {
                button.style.fontFamily = selectedFont;
            });
        });
    }

});



function populateLevels(difficulty) {
    const levelSelect = document.getElementById('level-select');
    levelSelect.innerHTML = '';

    const levels = gameData[difficulty];
    Object.keys(levels).forEach(level => {
        const option = document.createElement('option');
        option.value = level;
        option.textContent = level;
        levelSelect.appendChild(option);
    });

    levelSelect.value = "1"; // Default to Level 1 as a string
}

function displayHint() {
    const hint = gameData[currentDifficulty][currentLevel][currentQuestionIndex].hint;
    const hintElement = document.getElementById('hint');
    hintElement.innerText = hint;
    hintElement.style.visibility = 'visible';
}


function finishLevel() {
    flashImage(); // Display the completion image
    gtag('event', 'finish_level', {
        'event_category': 'Game Actions',
        'event_label': `Level Completed - Difficulty: ${currentDifficulty}, Level: ${currentLevel}`
    });
}


const completionImages = [
    'images/image1.webp',
    'images/image2.webp',
    'images/image3.webp',
    'images/image4.webp',
    'images/image5.webp',
    'images/image6.webp',
    'images/image7.webp',
    'images/image8.webp',
    'images/image9.webp',
    'images/image10.webp',
    'images/image11.webp',
    'images/image12.webp',
    'images/image13.webp',
    'images/image14.webp',
    'images/image15.webp',
    'images/image16.webp',
    'images/image17.webp',
    'images/image18.webp',
    'images/image19.webp',
    'images/image20.webp',
    'images/image21.webp',
    'images/image22.webp',
    'images/image23.webp',
    'images/image24.webp',
    'images/image25.webp',
    'images/image26.webp',
    'images/image27.webp',
    'images/image28.webp',
    'images/image29.webp',
    'images/image30.webp',
    'images/image31.webp',
    'images/image32.webp',
    'images/image33.webp',
    'images/image34.webp',
    'images/image35.webp', 
];
// Shuffle the completionImages array once at the beginning
shuffleArray(completionImages);
// Variable to keep track of the current image index
let currentImageIndex = 0;

function flashImage() {
    setTimeout(() => {
        const gameContainer = document.getElementById('game-container');
        const titleElement = document.querySelector('.game-wrapper > h1');

        gameContainer.style.display = 'none';
        titleElement.style.color = 'black';

        const imageContainer = document.createElement('div');
        imageContainer.style.opacity = '0';
        imageContainer.style.transition = 'opacity 1s ease-in-out';
        imageContainer.style.position = 'absolute';
        imageContainer.style.zIndex = '1000';
        imageContainer.style.width = '80%';
        imageContainer.style.maxWidth = '600px';
        imageContainer.style.margin = 'auto';
        imageContainer.style.left = '0';
        imageContainer.style.right = '0';
        imageContainer.style.top = '50%';
        imageContainer.style.transform = 'translateY(-50%)';
        imageContainer.style.textAlign = 'center';
        imageContainer.style.borderRadius = '10px';
        document.body.appendChild(imageContainer);

        const completionMessage = document.createElement('p');
        completionMessage.innerText = `Well done! You passed Level ${currentLevel}.`;
        completionMessage.style.fontSize = '24px';
        completionMessage.style.fontWeight = 'bold';
        completionMessage.style.marginBottom = '10px';
        imageContainer.appendChild(completionMessage);

        const clickMessage = document.createElement('p');
        clickMessage.innerText = "Click anywhere to continue";
        clickMessage.style.fontSize = '16px';
        imageContainer.appendChild(clickMessage);

        const imageSrc = completionImages[currentImageIndex];
        const image = document.createElement('img');
        image.src = imageSrc;
        image.alt = 'Flashing Image';
        image.style.width = '100%';
        image.style.borderRadius = '10px';
        imageContainer.appendChild(image);

        setTimeout(() => imageContainer.style.opacity = '1', 0);

        currentImageIndex = (currentImageIndex + 1) % completionImages.length;

        // Event Listener to remove the image container on click and progress to the next level/difficulty
        imageContainer.addEventListener('click', () => {
            document.body.removeChild(imageContainer);
            gameContainer.style.display = '';
            titleElement.style.color = '';

            let nextLevel = parseInt(currentLevel) + 1;
            let difficulties = Object.keys(gameData);
            let currentDifficultyIndex = difficulties.indexOf(currentDifficulty);

            if (nextLevel > Object.keys(gameData[currentDifficulty]).length) {
                if (currentDifficultyIndex < difficulties.length - 1) {
                    let nextDifficulty = difficulties[currentDifficultyIndex + 1];
                    startLevel(nextDifficulty, "1"); // Start first level of the next difficulty
                } else {
                    updateDisplay('Congratulations! You have completed all levels and difficulties.');
                }
            } else {
                startLevel(currentDifficulty, String(nextLevel));
            }
        });
    }, 2000);
}


function populateDifficulties() {
    const difficultySelect = document.getElementById('difficulty-selector');
    difficultySelect.innerHTML = ''; // Clear existing options

    Object.keys(gameData).forEach(difficulty => {
        const option = document.createElement('option');
        option.value = difficulty;
        option.textContent = difficulty;
        difficultySelect.appendChild(option);
    });
}

document.getElementById('instructions-button').addEventListener('click', function() {
    document.getElementById('instructions-container').style.display = 'block';
});

document.getElementById('close-instructions').addEventListener('click', function() {
    document.getElementById('instructions-container').style.display = 'none';
});

function playWordAudio(playIntro = true) {
    if (playIntro) {
        // Select a random intro audio file
        const introIndex = Math.floor(Math.random() * introAudios.length);
        const introAudioPath = `audio/intro_files/${introAudios[introIndex]}.mp3`;
        const introAudio = new Audio(introAudioPath);

        introAudio.onended = () => {
            // Play the word audio after the intro audio ends
            const currentWord = gameData[currentDifficulty][currentLevel][currentQuestionIndex].correct;
            const wordAudioPath = `audio/audio_files/${currentWord}.mp3`;
            const wordAudio = new Audio(wordAudioPath);
            wordAudio.play();
        };

        // Play the intro audio
        introAudio.play().catch(error => {
            console.error("Error playing intro audio:", error);
        });
    } else {
        // Play only the word audio
        const currentWord = gameData[currentDifficulty][currentLevel][currentQuestionIndex].correct;
        const wordAudioPath = `audio/audio_files/${currentWord}.mp3`;
        const wordAudio = new Audio(wordAudioPath);
        wordAudio.play();
    }
}

document.getElementById('play-audio').addEventListener('click', () => playWordAudio(false));

function createKeyboard() {
    const keyboardLayout = ['qwertyuiop', 'asdfghjkl', 'zxcvbnm'];
    const keyboardContainer = document.createElement('div');
    keyboardContainer.id = 'keyboard-container';
    gameContainer.appendChild(keyboardContainer);

    // Define a set of vibrant colors
    const colors = ['#007bff', '#17a2b8', '#fd7e14', '#6f42c1', '#20c997', '#FF7F50', '#FF00FF'];

    // Select a random color for all keyboard buttons
    const randomColorIndex = Math.floor(Math.random() * colors.length);
    const buttonColor = colors[randomColorIndex];

    keyboardLayout.forEach(row => {
        const rowDiv = document.createElement('div');
        rowDiv.className = 'keyboard-row';

        row.split('').forEach(letter => {
            const keyButton = document.createElement('button');
            keyButton.className = 'keyboard-key';
            keyButton.textContent = letter;

            // Apply the same random color to each keyboard button
            keyButton.style.backgroundColor = buttonColor;
            keyButton.style.color = 'white';

            keyButton.addEventListener('click', () => {
                handleKeyPress(keyButton, letter);
            });

            rowDiv.appendChild(keyButton);
        });

        keyboardContainer.appendChild(rowDiv);
    });
}


function setupGameContainer() {
    const spelledWordElement = document.createElement('div');
    spelledWordElement.id = 'spelled-word';
    gameContainer.insertBefore(spelledWordElement, gameContainer.firstChild);

    // Initialize the placeholder for the spelled word
    updateSpelledWordPlaceholder();
}

function updateSpelledWordPlaceholder() {
    const currentQuestion = gameData[currentDifficulty][currentLevel][currentQuestionIndex];
    const placeholder = '_ '.repeat(currentQuestion.correct.length).trim();
    document.getElementById('spelled-word').textContent = placeholder;
}

function handleKeyPress(button, letter) {
    const currentQuestion = gameData[currentDifficulty][currentLevel][currentQuestionIndex];
    const spelledWordElement = document.getElementById('spelled-word');
    let currentSpelling = spelledWordElement.textContent.replace(/_/g, '').trim();

    letter = letter.toLowerCase(); // Ensure letter is lowercase for comparison

    if (currentQuestion.correct.toLowerCase().startsWith(currentSpelling + letter)) {
        currentSpelling += letter;
        spelledWordElement.textContent = currentSpelling + ' ' + '_'.repeat(currentQuestion.correct.length - currentSpelling.length);
        button.classList.add('flash-green');
        setTimeout(() => button.classList.remove('flash-green'), 500);

        if (currentSpelling.toLowerCase() === currentQuestion.correct.toLowerCase()) {
            handleCorrectSpelling();
        }
    } else {
        // Flash the message container red and increment mistakes
        const messageContainer = document.getElementById('message');
        messageContainer.classList.add('flash-red');
        setTimeout(() => messageContainer.classList.remove('flash-red'), 500);
        mistakes++;
        updateDisplay('Oops, that’s not right. Try again.');
    }
}


function checkSpelling() {
    const spelledWord = document.getElementById('spelled-word').textContent.replace(/\s+/g, '');
    const currentQuestion = gameData[currentDifficulty][currentLevel][currentQuestionIndex];

    console.log(`Checking spelling: ${spelledWord}, Correct answer: ${currentQuestion.correct}`);

    if (spelledWord.toLowerCase() === currentQuestion.correct.toLowerCase()) {
        handleCorrectSpelling();
    }
}

function handleCorrectSpelling() {
    gameContainer.classList.add('flash-green');
    setTimeout(() => gameContainer.classList.remove('flash-green'), 500);
    score++;
    updateDisplay('Correct!');
    setTimeout(clearMessage, 5000);
    currentQuestionIndex++;

    if (currentQuestionIndex >= gameData[currentDifficulty][currentLevel].length) {
        updateDisplay('Round ' + currentLevel + ' complete! Moving to next level...');
        finishLevel();
    } else {
        setTimeout(() => {
            createWordButtons(gameData[currentDifficulty][currentLevel][currentQuestionIndex].words);
            // Reset the spelled word display for the next question
            updateSpelledWordPlaceholder();
        }, 500);
    }
}

function flashWord(word) {
    const hintElement = document.getElementById('hint');
    const originalHint = hintElement.innerText;
    hintElement.innerText = word;
    setTimeout(() => {
        hintElement.innerText = originalHint;
    }, 2000); // Flash the word for 2 seconds
}